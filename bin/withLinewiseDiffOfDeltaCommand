#!/bin/bash

printUsage()
{
    withDeltaCommand --help 2>&1 | sed \
	-e '1s#^.*$#Execute COMMAND(s) surrounded by two invocations of DELTA-COMMAND, and show the\nchanges of individual full lines in their respective outputs.#' \
	-e '2b removeFirstParagraphLoop' \
	-e '/^ *\(--sink-command\|--sink-exec\)/b removeOptionLoop' \
	-e '/^Usage:$/N' -e '/\(^\|\n\)Usage: */{ s/\(^\|\n\)\(Usage: *\)\?\([^ |]\+ \)*withDeltaCommand /\1\2'"$(basename "$1")"' /; s/|-s|--sink-command "COMMANDLINE" \[-s ...\]|--sink-exec SIMPLECOMMAND \[...\] ; \[--sink-exec ...\]\] //; }' \
	-e b -e :removeFirstParagraphLoop -e '{ /\(^\|\n\)$/{ s/^\(.*\n\)\?//; b; }; N; b removeFirstParagraphLoop; }' \
	-e b -e :removeOptionLoop -e '{ /\n *\(--sink-command\|--sink-exec\)[^\n]*$/{ N; b removeOptionLoop; }; /\n *--[^\n]*$\|\n[^	 ]\|\n$/{ s/^\(.*\n\)\?//; b; }; N; b removeOptionLoop; }'
}
case "$1" in
    --help|-h|-\?)	shift; printUsage "$0"; exit 0;;
esac

exec withDeltaCommand --sink-command 'linewisediff {A} {B}' "$@"
